% !TEX program = lualatex
% !TEX encoding = UTF-8 unicode
\documentclass{book}
\usepackage{graphicx} % Required for inserting images
\usepackage{mdframed}


\usepackage{style}
\usepackage{circuitikz}
\usetikzlibrary{tikzmark}
\usepackage{tikz}
\usepackage{circuitikz}

% \newtcbox{\inlinecode}{on line,
%   box align=base,
%   colback=gray!20,
%   colframe=gray!50,
%   boxrule=0pt,
%   arc=1pt,
%   top=0.5pt,
%   bottom=0.5pt,
%   left=2pt,
%   right=2pt,
%   fontupper=\ttfamily\small
% }
% Define a custom style for x86-64 Assembly
\lstdefinelanguage[x64]{Assembler}%
  [x86masm]{Assembler}% base language
  {morekeywords=[1]{rax, rbx, rcx, rdx, rsi, rdi, rsp, rbp,
                    r8, r9, r10, r11, r12, r13, r14, r15,
                    eax, ebx, ecx, edx, esi, edi, esp, ebp},
   morekeywords=[2]{mov, push, pop, call, ret, jmp, je, jne, cmp, test,
                    add, sub, imul, idiv, xor, or, and, lea, inc, dec}}

% Custom style
\lstdefinestyle{asmstyle}{
    language=[x64]Assembler,
    basicstyle=\ttfamily\footnotesize,
    keywordstyle=[1]\color{blue},
    keywordstyle=[2]\color{purple}\bfseries,
    commentstyle=\color{gray}\itshape,
    morecomment=[l]{;},
    showstringspaces=false,
    columns=fullflexible,
    frame=single,
    captionpos=b
}

% Define a custom style for x86-64 Assembly
\lstdefinelanguage[x64]{Assembler}%
  [x86masm]{Assembler}% base language
  {morekeywords=[1]{rax, rbx, rcx, rdx, rsi, rdi, rsp, rbp,
                    r8, r9, r10, r11, r12, r13, r14, r15,
                    eax, ebx, ecx, edx, esi, edi, esp, ebp},
   morekeywords=[2]{mov, push, pop, call, ret, jmp, je, jne, cmp, test,
                    add, sub, imul, idiv, xor, or, and, lea, inc, dec}}

% Custom style
\lstdefinestyle{asmstyle}{
    language=[x64]Assembler,
    basicstyle=\ttfamily\footnotesize,
    keywordstyle=[1]\color{blue},
    keywordstyle=[2]\color{purple}\bfseries,
    commentstyle=\color{gray}\itshape,
    morecomment=[l]{;},
    showstringspaces=false,
    columns=fullflexible,
    frame=single,
    captionpos=b
}
\newtcbox{\inlinecode}{
    on line,
    boxsep=1pt,
    left=2pt,
    right=2pt,
    top=1pt,
    bottom=1pt,
    colback=gray!20,      % background (Markdown-like)
    colframe=gray!20,     % same color as background (no visible border)
    boxrule=0pt,
    arc=2pt,              % rounded corners
    box align=base,
    fontupper=\ttfamily
}
\let\oldtexttt\texttt
\renewcommand{\texttt}[1]{\inlinecode{#1}}

\lstdefinelanguage[RISC-V]{Assembler}
{
  alsoletter={.}, % allow dots in keywords
  alsodigit={0x}, % hex numbers are numbers too!
  morekeywords=[1]{ % instructions
    lb, lh, lw, lbu, lhu, li,
    sb, sh, sw,
    sll, slli, srl, srli, sra, srai,
    add, addi, sub, lui, auipc,
    xor, xori, or, ori, and, andi,
    slt, slti, sltu, sltiu,
    beq, bne, blt, bge, bltu, bgeu,
    j, jr, jal, jalr, ret,
    scall, break, nop
  },
  morekeywords=[2]{ % sections of our code and other directives
    .align, .ascii, .asciiz, .byte, .data, .double, .extern,
    .float, .globl, .half, .kdata, .ktext, .set, .space, .text, .word
  },
  morekeywords=[3]{ % registers
    zero, ra, sp, gp, tp, s0, fp,
    t0, t1, t2, t3, t4, t5, t6,
    s1, s2, s3, s4, s5, s6, s7, s8, s9, s10, s11,
    a0, a1, a2, a3, a4, a5, a6, a7,
    ft0, ft1, ft2, ft3, ft4, ft5, ft6, ft7,
    fs0, fs1, fs2, fs3, fs4, fs5, fs6, fs7, fs8, fs9, fs10, fs11,
    fa0, fa1, fa2, fa3, fa4, fa5, fa6, fa7
  },
  morecomment=[l]{;},   % mark ; as line comment start
  morecomment=[l]{\#},  % as well as # (even though it is unconventional)
  morestring=[b]",      % mark " as string start/end
  morestring=[b]'       % also mark ' as string start/end
}

\lstset{
  backgroundcolor=\color{gray!10},
  basicstyle=\ttfamily\small,
  keywordstyle=\color{blue},
  commentstyle=\color{green!60!black},
  stringstyle=\color{orange},
  showstringspaces=false,
  breaklines=true,
  frame=single,
}




\title{Computer Architecture \\ Prof. Paolo Ienne}
\author{Arthur Herbette}
\date{October 2025}

\begin{document}

\maketitle

\newpage
\tableofcontents
\newpage
\chapter{Introduction}
This document is the note I have written during and outside of the course, all the information here is directly taken from the course, slides, etc... However mistake can happen, if you see some mistake or see something that is not clear, feel free to ping an issue on the github, or email/telegram me.\\
\textbf{Disclaimer} in this course, when we say \textit{high-level language} we mean a language that is compiled/interpreted for instance: \texttt{c} is a high-level language here.
\subsection{Content of the course}
The course is divided into three parts:
\begin{itemize}
	\item \textbf{Part I: Processors and ISA}  \\ What is a processor? How can we design one? How do programs look like when they are executed? 
	\item \textbf{Part II: I/Os and Exceptions} \\ What is arounf a processor to make a full computer? How the processor exchanges information with the rest of the world? 
	\item \textbf{Part III: Memory Hierarchy} \\ Processors are fast and memory is slow -how can one combine the two? How can one protext the data users in memory
	\item \textbf{Parti IV: Instruction-Level Parallelism} \\ What makes a good processor? How real processors achieve ever increasing performances? 
	\item \textbf{Part V: Multiprocessors} \\ What are the basic challeng of connecting many processors together? What changes from a single processor system? 
	\item \textbf{Parti VI: Rudiments of Hardware Secrurity} \\ How can a hacker exploit what we have built in the previous parts to attack a system? How physics helps jeopardizing security?
\end{itemize}
\subsubsection{Literature}
The course will have two books for the literature which are the same as the one for fds :
\begin{enumerate}
    \item Digital Design: Principles and Practices John F. Wakerly 
    \item Computer organization and design: The hardware software interface David A. Patterson, John L. Hennessy
\end{enumerate}
\scalebox{0.4}{
\begin{circuitikz}
\tikzstyle{every node}=[font=\large]
\draw  (-3.25,30.5) rectangle (3,20.5);
\draw  (-1.25,29.75) rectangle  node {\LARGE Controller} (-1.25,29.75);
\draw  (1.75,29) -- (1.75,29) -- (2.25,29) -- (2.25,29) -- cycle;
\node [font=\normalsize] at (2,29.75) {sel\_imm};
\node [font=\normalsize] at (2,28.5) {branch\_op};
\node [font=\normalsize] at (1.75,28) {rf\_we};
\node [font=\normalsize] at (1.75,27.5) {sel\_addr};
\node [font=\normalsize] at (1.75,27) {sel\_b};
\node [font=\normalsize] at (2,26.5) {sel\_mem};
\node [font=\normalsize] at (1.75,26) {pc\_en};
\node [font=\normalsize] at (1.75,25.5) {pc\_sel\_pc\_base};
\node [font=\normalsize] at (1.5,24.75) {pc\_add\_imm};
\node [font=\normalsize] at (1.5,24.25) {pc\_sel\_alu};
\node [font=\normalsize] at (1.75,23.5) {sel\_pc};
\node [font=\normalsize] at (2,23) {we};
\node [font=\normalsize] at (2,22.5) {op\_alu};
\node [font=\normalsize] at (0.75,21) {imm};
\node [font=\normalsize] at (-1,21) {ir\_en};
\node [font=\normalsize] at (-2.25,24) {instruction};
\node [font=\normalsize] at (-2.5,25.5) {rst\_n};
\node [font=\normalsize] at (-2.5,27.25) {clk};
\draw (3,29.75) to[short] (4.25,29.75);


\draw (7.25,29.75) to[short] (7.5,29.75);
\draw (7.25,29.25) to[short] (7.5,29.25);
\draw (7.5,29.75) node[ieeestd and port, anchor=in 1, scale=0.89](port){} (port.out) to[short] (9.25,29.5);
\draw [ line width=0.7pt](3,29.75) to[short] (7.5,29.75);
\draw [ line width=0.7pt](6.75,29.25) to[short] (7.25,29.25);
\node [font=\normalsize] at (6,29.25) {alu\_res};
\draw [ line width=0.7pt](3,26) to[short] (10.75,26);
\draw [ line width=0.7pt](10.75,26) to[short] (10.75,29);
\draw [ line width=0.7pt](9.25,29.5) to[short] (10.75,29.5);
\draw (12.5,29.5) to[short] (12.75,29.5);
\draw (12.5,29) to[short] (12.75,29);
\draw (12.75,29.5) node[ieeestd or port, anchor=in 1, scale=0.89](port){} (port.out) to[short] (14.5,29.25);
\draw [ line width=0.7pt](10.75,29) to[short] (12.5,29);
\draw [ line width=0.7pt](10.75,29.5) to[short] (12.75,29.5);
\draw [ line width=0.7pt ] (16.75,31.75) rectangle (23.5,18.5);
\draw [ line width=0.7pt ] (20.5,24.75) rectangle  node {\Huge PC} (20.5,24.75);
\node [font=\normalsize] at (17.75,31) {clk};
\node [font=\normalsize] at (17.5,30.25) {rst\_n};
\node [font=\normalsize] at (17.75,27.5) {};
\node [font=\normalsize] at (18.25,26.75) {sel\_pb\_base};
\node [font=\normalsize] at (18.25,26) {add\_imm};
\node [font=\normalsize] at (18,24.75) {imm};
\node [font=\normalsize] at (17.75,24.25) {sel\_alu};
\node [font=\normalsize] at (17.75,23.5) {alu};
\node [font=\normalsize] at (17.25,29.5) {en};
\draw [ line width=0.7pt](14.5,29.25) to[short] (16.75,29.25);
\draw [ line width=0.7pt](16.75,30.25) to[short] (15.5,30.25);
\draw [ line width=0.7pt](16.75,31.25) to[short] (15.5,31.25);
\draw [ line width=0.7pt](3,25.75) to[short] (15,25.75);
\draw [ line width=0.7pt](16.75,26.75) to[short] (15,26.75);
\draw [ line width=0.7pt](15,26.75) to[short] (15,25.75);
\draw [ line width=0.7pt](16.75,26) to[short] (15.5,26);
\draw [ line width=0.7pt](3,25) to[short] (15.5,25);
\draw [ line width=0.7pt](15.5,26) to[short] (15.5,25);
\draw [ line width=0.7pt](3,24.25) to[short] (16.75,24.25);
\node [font=\normalsize] at (22.25,19.25) {addr};
\draw [ line width=0.7pt ] (3.25,12.75) rectangle (17.75,4.75);
\draw [ line width=0.7pt ] (-6.25,16) rectangle (-2.25,10.75);
\draw [ line width=0.7pt ] (-4.5,13.75) rectangle  node {\Huge IR} (-4.5,13.75);
\draw [ line width=0.7pt ] (10,8.75) rectangle  node {\Huge Register File} (10,8.75);
\node [font=\large] at (16.75,11.25) {a};
\node [font=\large] at (16.75,6.75) {b};
\draw [ line width=0.7pt](21.75,8.25) -- (22.25,8.25);
\draw [ line width=0.7pt](21.75,7.75) -- (22.25,7.75);
\draw [ line width=0.7pt] (22.25,8.75) -- (22.25,7.25) -- (23.25,7.75) -- (23.25, 8.25) -- (22.25,8.75);
\draw [ line width=0.7pt](23.25,8) -- (23.75,8);
\draw [ line width=0.7pt](22.75,9.25) -- (22.75,8.64);
\node [font=\large] at (22.75,8) {};
\draw [ line width=0.7pt](17.75,6.75) to[short] (21.75,6.75);
\draw [ line width=0.7pt](21.75,7.75) to[short] (21.75,6.75);
\draw [ line width=0.7pt](21.75,8.25) to[short] (19.75,8.25);
\draw [ line width=0.7pt](19.75,8.25) to[short] (19.75,15);
\draw [ line width=0.7pt](19.75,15) to[short] (6.25,15);
\draw [ line width=0.7pt](0.75,20.5) to[short] (0.75,15);
\draw [ line width=0.7pt](6.25,15) to[short] (0.75,15);
\draw [ line width=0.7pt](16.75,25) to[short] (16,25);
\draw [ line width=0.7pt](16,25) to[short] (16,15);
\draw [ line width=0.7pt](16.75,23.5) to[short] (15,23.5);
\node [font=\normalsize] at (14.25,23.75) {alu\_res};
\node [font=\normalsize] at (22,9.5) {sel\_b};
\draw [ line width=0.7pt ] (24.75,12.25) rectangle (28.5,6.5);
\draw [ line width=0.7pt ] (26.75,9.75) rectangle  node {\Huge ALU} (26.75,9.75);
\draw [ line width=0.7pt](23.75,8) to[short] (24.75,8);
\draw [ line width=0.7pt](17.75,11.25) to[short] (24.75,11.25);
\draw [ line width=0.7pt](26.75,12.25) to[short] (26.75,14.75);
\node [font=\large] at (26,14.75) {op\_alu};
\draw [ line width=0.7pt](28.5,9.5) to[short] (32.5,9.5);
\draw [ line width=0.7pt](32.5,9.75) -- (33,9.75);
\draw [ line width=0.7pt](32.5,10.25) -- (33,10.25);
\draw [ line width=0.7pt] (33,9.25) -- (33,10.75) -- (34,10.25) -- (34, 9.75) -- (33,9.25);
\draw [ line width=0.7pt](34,10) -- (34.5,10);
\draw [ line width=0.7pt](33.5,8.75) -- (33.5,9.64);
\node [font=\large] at (33.5,10) {};
\draw [ line width=0.7pt](32.5,10) to[short] (32.5,9.5);
\draw [ line width=0.7pt](32.5,10.25) to[short] (30.5,10.25);
\node [font=\large] at (30.5,10.75) {imm};
\node [font=\large] at (33.25,8.5) {sel\_imm};
\draw [ line width=0.7pt](38.25,9.5) -- (38.75,9.5);
\draw [ line width=0.7pt](38.25,10) -- (38.75,10);
\draw [ line width=0.7pt] (38.75,9) -- (38.75,10.5) -- (39.75,10) -- (39.75, 9.5) -- (38.75,9);
\draw [ line width=0.7pt](39.75,9.75) -- (40.25,9.75);
\draw [ line width=0.7pt](39.25,8.5) -- (39.25,9.39);
\node [font=\large] at (39.25,9.75) {};
\draw [ line width=0.7pt](34.5,10) to[short] (38.25,10);
\draw [ line width=0.7pt](22.25,18.5) to[short] (22.25,16);
\draw [ line width=0.7pt](22.25,16) to[short] (29,16);
\draw [ line width=0.7pt](29,16) to[short] (29,8.75);
\draw [ line width=0.7pt](29,8.75) to[short] (29,7.5);
\draw [ line width=0.7pt](29.25,7.5) to[short] (31.75,7.5);
\draw [ line width=0.7pt](29.5,7.5) to[short] (29,7.5);
\draw [ line width=0.7pt](32.25,7.25) -- (32.75,7.25);
\draw [ line width=0.7pt](32.25,7.75) -- (32.75,7.75);
\draw [ line width=0.7pt] (32.75,6.75) -- (32.75,8.25) -- (33.75,7.75) -- (33.75, 7.25) -- (32.75,6.75);
\draw [ line width=0.7pt](33.75,7.5) -- (34.25,7.5);
\draw [ line width=0.7pt](33.25,6.25) -- (33.25,7.14);
\node [font=\large] at (33.25,7.5) {};
\draw [ line width=0.7pt](31.75,7.75) to[short] (32.75,7.75);
\draw [ line width=0.7pt](31.75,7.5) to[short] (31.75,8);
\draw [ line width=0.7pt](34.25,7.5) to[short] (38,7.5);
\draw [ line width=0.7pt](38,7.5) to[short] (38,9.5);
\draw [ line width=0.7pt](38,9.5) to[short] (38.75,9.5);








\node [font=\large] at (33.25,6) {sel\_mem};



\draw [ line width=0.7pt](40,9.75) to[short] (43.75,9.75);
\draw [ line width=0.7pt](43.75,9.75) to[short] (43.75,4.5);
\draw [ line width=0.7pt](43.75,4.5) to[short] (23.5,4.5);
\draw [ line width=0.7pt](23.5,4.5) to[short] (19.75,4.5);
\draw [ line width=0.7pt](19.75,4.5) to[short] (19.75,2);
\draw [ line width=0.7pt](19.5,2) to[short] (1.75,2);
\draw (39,6.5) to[short] (39,6.75);
\draw (39.5,6.5) to[short] (39.5,6.75);
\draw (39,6.75) node[ieeestd or port, anchor=in 1, scale=0.89, rotate=90](port){} (port.out) to[short] (39.25,8.75);
\node [font=\large] at (39.75,6.25) {sel\_pc};
\draw [ line width=0.7pt](33.25,6.5) to[short] (39,6.5);
\draw [ line width=0.7pt](29.25,9.5) to[short] (29.25,17.25);
\draw [ line width=0.7pt](30.25,17.25) -- (30.75,17.25);
\draw [ line width=0.7pt](30.25,17.75) -- (30.75,17.75);
\draw [ line width=0.7pt] (30.75,16.75) -- (30.75,18.25) -- (31.75,17.75) -- (31.75, 17.25) -- (30.75,16.75);
\draw [ line width=0.7pt](31.75,17.5) -- (32.25,17.5);
\draw [ line width=0.7pt](31.25,16.25) -- (31.25,17.14);
\node [font=\large] at (31.25,17.5) {};
\draw [ line width=0.7pt](29.25,17.25) to[short] (30.25,17.25);
\draw [ line width=0.7pt](22.25,17.75) to[short] (30.5,17.75);
\node [font=\large] at (31.25,16) {sel\_addr};
\draw [ line width=0.7pt](32.25,17.5) to[short] (36.75,17.5);
\node [font=\large] at (4.25,11.75) {clk};
\node [font=\large] at (4,10.75) {aa};
\node [font=\large] at (4,9.75) {ab};
\node [font=\large] at (3.75,8.75) {aw};
\node [font=\large] at (4,7.75) {wren};
\node [font=\large] at (4,6.5) {wrdata};
\draw [ line width=0.7pt](1.75,2) to[short] (1.75,6.5);
\draw [ line width=0.7pt](1.75,6.5) to[short] (3.25,6.5);
\draw [ line width=0.7pt](1,7.75) to[short] (3.25,7.75);
\draw [ line width=0.7pt](0.5,8.75) to[short] (3.25,8.75);
\draw [ line width=0.7pt](-2.25,14.75) to[short] (2,14.75);
\draw [ line width=0.7pt](2,14.75) to[short] (2,10.75);
\draw [ line width=0.7pt](2,10.75) to[short] (3.25,10.75);
\draw [ line width=0.7pt](1,14.75) to[short] (1,9.75);
\draw [ line width=0.7pt](1,9.75) to[short] (3.25,9.75);
\draw [ line width=0.7pt](2.5,11.75) to[short] (3.25,11.75);
\draw [ line width=0.7pt](-0.75,14.75) to[short] (-0.75,10.5);
\draw [ line width=0.7pt](-1.5,14.75) to[short] (-1.5,18.25);
\draw [ line width=0.7pt](-1.5,18.25) to[short] (-4.75,18.25);
\draw [ line width=0.7pt](-4.75,18.25) to[short] (-4.75,23.75);
\draw [ line width=0.7pt](-4.75,23.75) to[short] (-3.25,23.75);
\draw [ line width=0.7pt](-9.25,27.75) to[short] (-3.25,27.75);
\draw [ line width=0.7pt](-9.75,25.5) to[short] (-3.25,25.5);
\draw [ line width=0.7pt](-8,15) to[short] (-6.25,15);
\draw [ line width=0.7pt](-7.75,12) to[short] (-6.25,12);
\end{circuitikz}
}
\chapter{Processors and instruction set architecture}
\input{1a}
\input{1b}
\input{1c}
\input{1d}
\input{1e}
\chapter{Processors, I/Os, and Exceptions}
\input{2a}
\input{2b}
\input{2c}
\input{2d}
\input{2e}
\chapter{Memory Hierarchy}
\input{3a}


\end{document}
